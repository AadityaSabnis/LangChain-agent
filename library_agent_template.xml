<?xml version="1.0" encoding="UTF-8"?>
<odoo>
  <template id="library_agent_page" name="Library Agent Page">
    <t t-call="website.layout">
      <div class="container mt-5 text-center">
        <h2>Library Agent</h2>
        <input type="text" id="questionInput" placeholder="Ask a question..." style="width: 60%; padding: 8px;" />
        <br /><br />
        <button id="askButton" style="padding: 6px 12px;">Ask</button>
        <p id="responseOutput" style="margin-top: 20px;"></p>
      </div>

      <script type="text/javascript">
        <![CDATA[
        document.addEventListener("DOMContentLoaded", function () {
          document.getElementById("askButton").addEventListener("click", function () {
            const question = document.getElementById("questionInput").value;
            const responseBox = document.getElementById("responseOutput");
            responseBox.innerText = "Loading...";

            fetch("/library/agent_query", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
                "X-Requested-With": "XMLHttpRequest"
              },
              body: JSON.stringify({ question: question })
            })
            .then(response => response.json())
            .then(data => {
              console.log("Received data:", data);  // Debugging log
              if (data && data.response) {
                responseBox.innerText = data.response;
              } else if (data.result && data.result.result && data.result.result.response) {
                responseBox.innerText = data.result.result.response;
              } else {
                responseBox.innerText = "No response received.";
              }
            })
            .catch(err => {
              console.error("Fetch error:", err);
              responseBox.innerText = "Error contacting server.";
            });
          });
        });
        ]]>
      </script>
    </t>
  </template>
</odoo>
